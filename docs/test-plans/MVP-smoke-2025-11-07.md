# CKS Portal – MVP Smoke Test (Production)

Scope: Validate core flows for Services (manager- vs warehouse-managed), Reports, and Feedback using test accounts on production.

## Preconditions
- Backend healthy: visit `https://api.portal.ckscontracting.ca/api/health` (expect 200 JSON)
- Frontend reachable: `https://portal.ckscontracting.ca` (Clerk login visible)
- Clerk Allowed Origins includes `https://portal.ckscontracting.ca`
- Test users exist in Clerk and bootstrap on first login (or seeded)

Test accounts (example)
- Manager: MGR-XXXX
- Warehouse: WHS-XXXX
- Crew: CRW-XXXX
- Contractor/Customer/Center as needed

## Services

1) Manager-managed lifecycle
- Login as Manager
- Create or open a manager-managed service (metadata.serviceManagedBy = manager)
- Quick Actions: Start → status changes to in_progress
- Complete → status changes to completed (toasts show)
- Cancel from pending/in_progress → requires confirm → activities reflect cancellation

2) Warehouse-managed lifecycle
- Login as Warehouse
- Open a warehouse-managed service (metadata.serviceManagedBy = warehouse)
- Quick Actions: Start/Complete/Cancel enabled for Warehouse; Manager should see view-only

3) Assignments (Manager)
- In Service modal → Assignments tab
- Invite 1–2 crew (toast: request sent)
- Login as Crew → accept invite (toast); Manager feed shows crew_assigned_to_service
- Back as Manager → Unassign crew (toast); activities show crew_unassigned_from_service

4) Crew tasks
- Login as Crew → open service (My Tasks tab)
- Mark one task complete → activity service_task_completed appears for stakeholders
- Check header badges: Managed By (Warehouse/Manager) and Due Today count when tasks are due

5) Activities visibility and copy
- Manager feed includes: service_crew_requested (own requests), crew_assigned_to_service, service_task_completed
- Crew feed includes: service_crew_response (accept), crew_unassigned_from_service
- Warehouse feed includes lifecycle for warehouse-managed services

## Reports & Feedback

1) Submit structured report
- From any hub, open Reports → Create
- Type: Report; Category: Order or Service; pick entity; Reason; Priority
- Submit (toast). Item appears in Reports tab

2) Acknowledge
- As appropriate role (Manager or Warehouse per category/managedBy), open list and click Acknowledge
- Toast and card show acknowledgment

3) Resolve
- As allowed role, click Resolve → fill Action Taken + Notes → Mark as Resolved
- Status chip shows Resolved; activities post; permissions respected by category

4) Feedback flow
- Submit Feedback with rating (1–5)
- Status chip shows Open; rating pill shows stars; Acknowledge allowed; resolving is optional

5) Archive/Restore
- Close/Archive item (where enabled); verify Archive tab shows item
- Restore if applicable; verify counts update

## API/CORS
- Open browser devtools Network tab
- Actions hit `https://api.portal.ckscontracting.ca/api/...`
- No CORS errors; all 2xx responses

## Regression checks
- Open Order modal by clicking an order from activities (ID-first)
- Open Service modal via activities and list cards
- Verify SWR cache refreshes: lists update after actions without hard refresh

## Exit Criteria
- All above steps pass without errors
- No console errors (CORS or unhandled exceptions)
- Activities appear for the intended roles with clear messages

