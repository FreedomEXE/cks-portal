# CKS Portal – Project Outline & PRD

## 1. Project Overview
The CKS Portal is a role-based web application that centralizes service delivery operations. CKS acts as an outsourced service provider for contractors, handling service delivery to the contractor's existing customers. The portal replaces spreadsheet workflows ("CKS Brain") with a secure, scalable system.

### **CKS Business Model**
- **Contractors** outsource their service delivery to CKS
- **Customers** are the contractor's existing clients who receive services
- **Centers** are physical locations (customer facilities) where services are performed
- **CKS Crew** perform the actual service work (maintenance, cleaning, etc.)
- **CKS Managers** coordinate operations and oversee multiple centers
- **CKS Admin** creates users and manages the entire system

### **Key Capabilities**
- Admin directory with unified entity management (12-tab system)
- Role-based authentication with username-scoped hubs (`/{id}/hub`)
- Service/supply ordering by Centers and Managers
- Flexible crew assignment (permanent, temporary, or one-time jobs)
- Training and procedural documentation access
- Reporting from Centers to Managers/Admins

---

## 3. Tech Stack & Tools

### **Frontend**
- **React + Vite** (TypeScript)
- **Tailwind CSS** for styling
- **Clerk** for authentication
- **React Router** for client-side routing

### **Backend**
- **Node.js + Express/Fastify** (TypeScript, evaluating both frameworks)
- **PostgreSQL** – Direct queries (Prisma evaluation pending)
- **pg** – PostgreSQL client
- **dotenv** – environment configuration
- **CORS** – API cross-origin handling

### **Development Tools**
- **VS Code** – code editing
- **Beekeeper Studio** – database management
- **GitHub** – version control
- **npm** – package management
- **ts-node-dev** – TypeScript hot reloading for backend

### **Hosting / Deployment**
- **Vercel** – frontend hosting
- **Render** – backend hosting + PostgreSQL database

---

## 4. Data Model (Entities)

| Entity       | ID Format  | Description |
|--------------|-----------|-------------|
| **Crew**     | `CRW-XXX` | Individual staff members |
| **Contractor** | `CON-XXX` | Contracting companies working with CKS |
| **Customer** | `CUS-XXX` | Customers receiving services |
| **Center**   | `CEN-XXX` | Physical service locations |
| **Manager**  | `MGR-XXX` | CKS operations managers |
| **Admin**    | `ADM-XXX` | System administrators |
| **Services** | `SRV-XXX` | Provided services |
| **Supplies** | `SUP-XXX` | Provided products/supplies |
| **Procedures** | `PRC-XXX` | Process & operational guides |
| **Training** | `TRN-XXX` | Training materials |
| **Warehouses** | `WH-XXX` | Supply storage facilities |
| **Reports** | `RPT-XXX` | Center-generated reports on job quality/issues |

**Entity Relationships:**
- **Contractors** have **Customers** who have **Centers** (physical locations)
- **CKS Crew** are assigned to **Centers** (flexible: permanent, temporary, or one-time jobs)
- **CKS Managers** oversee multiple **Centers** and coordinate **Crew**
- **Both Customers AND Centers** can place service/supply orders
- **Admin** creates all users and manages crew assignments
- **Reports** are generated by Centers, visible to assigned Managers and Admins
- **Training/Procedures** accessible by all roles with appropriate restrictions

---

## 5. MVP Scope - Ready to Ship

**MVP Definition**: Fully functional app with all core business operations working seamlessly.

### **Critical MVP Features (Must Work)**

#### **1. User Management (Admin Hub)**
- Create new users of any role type (MGR-XXX, CON-XXX, CUS-XXX, CEN-XXX, CRW-XXX)
- New users can immediately log in and access their role-appropriate hub
- ID-based authentication integration with Clerk

#### **2. Service Operations**
- **Ordering System**: Centers and Managers can place service/supply orders (complete workflow)
- **Service Requests**: Full request-to-fulfillment process functional
- **Order Management**: Admin oversight and processing of all orders/requests

#### **3. Reporting System**
- Centers can create reports
- Reports visible to appropriate roles (Managers, Admins, related entities)
- Basic report management and status tracking

#### **4. Role-Based Access**
- Each hub shows only appropriate data for that role
- Secure data isolation between roles
- Core functionality accessible from each hub

#### **5. Essential Hub Functions**
- **Admin**: User creation, system management, order oversight
- **Manager**: Multi-center oversight, order placement, report review
- **Center**: Report creation, order placement, center activity view
- **Contractor/Customer**: View operations, basic management functions
- **Crew**: Assignment view, basic task management

### **Not Required for MVP**
- Crew timesheets and advanced time tracking
- Advanced analytics and reporting
- Real-time notifications
- Payment processing
- Advanced workflow automation

## 6. User Interface & Role Requirements

### **Admin Hub**
**Wants to:**
- Browse, search, and filter every entity (crew, contractors, customers, centers, services, supplies, jobs, procedures, training, management, warehouses)
- Create new users of any type and have them immediately functional
- Triage incoming reports and oversee Orders/Requests
- Impersonate (View As) for troubleshooting
- Access system management and oversight functions

**System must:**
- Provide unified Admin Directory with fast search/pagination and consistent tables
- Offer Orders and Reports views with clear status and filters
- Support user creation workflow that integrates with authentication system
- Allow navigation to any entity profile via IDs
- Provide role-safe fallbacks for missing data

### **Manager Hub**
**Wants to:**
- Oversee assigned centers and crews
- Place orders/requests on behalf of centers
- Triage reports from their centers and resolve or escalate
- Access multi-center operational views

**System must:**
- Provide Manager Hub with multi-center views
- Allow managers to initiate requests and view statuses across their centers
- Surface reports tied to their centers with actions and communication hooks
- Show crew assignments and center operational status

### **Center Hub**
**Wants to:**
- View assigned contractor/customer info and available services/supplies
- Request services/supplies quickly with status tracking
- Create reports for operational issues
- Access info on all crew assigned to center including training/procedures
- View all center activity and operational metrics

**System must:**
- Provide Center Hub with prominent "New Request" CTA and request history
- Pull catalog options from admin-managed sources (services/supplies)
- Enable report creation and submission workflow
- Show assigned crew and their current status
- Keep the flow mobile-friendly and resilient to partial data

### **Contractor Hub**
**Wants to:**
- See assigned customers and centers
- Confirm orders and services/supply requests from customers/centers
- Access operational oversight of their customer relationships

**System must:**
- Provide Contractor Hub with clear links to assigned entities
- Surface orders/requests actions aligned with permissions and center context
- Show relationship mapping between their customers and centers

### **Customer Hub**
**Wants to:**
- View centers and services tied to their organization
- Initiate or review service/supply requests when permitted
- Access operational visibility into their centers

**System must:**
- Provide Customer Hub with actionable links and read access to relevant entities
- Enable request initiation where contracts allow
- Ensure data visibility follows role and account relationships
- Show center status and service history

### **Crew Hub**
**Wants to:**
- See assignments and context (center/jobs) when available
- Access training and procedures
- View work schedule and basic task management

**System must:**
- Provide Crew Hub with role-appropriate visibility
- Show assigned center and upcoming work when data is ready
- Provide access to training materials and procedural documentation
- Display current assignment status and basic work tracking

## 7. Technical Architecture (TBD)

### **Backend-Frontend-Database Integration**
*This section will detail how user IDs (MGR-XXX, CON-XXX, etc.) integrate with:*
- *Clerk authentication system*
- *Database user management*
- *Role-based data access*
- *API endpoint security*
- *Session management*

*[To be completed when backend architecture is finalized]*

## 8. Post-MVP Ideas
- Crew timesheets and advanced time tracking
- Advanced analytics and reporting dashboards
- Real-time notifications and messaging
- Job scheduling and assignment automation
- Payments/invoicing integration
- Advanced workflow customization

## 9. Deployment Plan
- **Development**: Local setup (Vite frontend, Node.js backend)
- **Staging**: Render (backend) + Vercel (frontend) 
- **Production**: Same stack with production database

## 10. Current Status (August 2025) - ~40-45% Complete

### ✅ **Completed Features**
- **Frontend Hub Architecture**: All 6 role-based hubs implemented with complete independence
- **Authentication Flow**: Clerk-based login with username-scoped routing (`/{id}/hub`)
- **Admin Directory**: 12-tab unified directory system for entity management
- **UI Templates**: All hubs populated with realistic template data (user-specific when logged in)
- **Smart ID System**: MGR-XXX, CON-XXX, CUS-XXX, CEN-XXX, CRW-XXX format implemented
- **Profile System**: Header UserWidget with role-specific profile access
- **Docker Setup**: Cross-browser testing environment configured

### 🔑 **Hub Data Architecture**
**CRITICAL**: Admin Hub = Real database access | All other hubs = User-specific template data
- **Admin Hub**: Direct access to all database entities for system management
- **Role Hubs**: Template structure populated with user-specific data based on their relationships and permissions
- **Current State**: Templates show sample data, backend integration will populate with real user data

### 🚧 **In Progress/Needs Work**
- **Backend Integration**: Frontend hubs need connection to database APIs
- **Database Configuration**: PostgreSQL schema exists but relationships need implementation
- **User Creation System**: Admin Hub user creation forms need backend connectivity
- **ID-based Authentication**: Integration of custom IDs (MGR-XXX, etc.) with Clerk authentication
- **Data Flow**: Replace template data with real database queries
- **Request Processing**: Service/supply order forms need backend connectivity

### ❌ **Not Started**
- **Testing Suite**: Comprehensive testing across frontend and backend
- **Production Deployment**: Staging and production environment setup
- **Advanced Features**: Reporting workflows, real-time notifications
## 10. Next Steps

### Frontend
- Continue applying shared UI primitives (Button, Input, Select, Badge, Alert, Card, Table, Tabs, Pagination) across pages for consistency.
- Verify header UserWidget behavior across routes; ensure navigation to `/me/profile` is consistent, with Admin suppression.
- Accessibility: add ARIA roles/labels and keyboard navigation for tabs and the UserWidget.
- Tests: add routing/unit tests for My Profile tabs and the Admin Directory tab bar.
- Improve loading/empty states in Directory tabs (skeletons, “no data yet” messages).

### Backend
- Confirm manager role derivation/mapping for `MGR-###` codes in `/me/profile` and bootstrap.
- Provide minimal fixtures/stub endpoints for manager-related tabs to enable UI wiring.
- Prepare impersonation audit logging endpoints (start/stop) aligned to PRD design notes.

### Docs & Process
- Add/confirm ADR on the Single Profile Entry Point and Admin suppression.
- Keep PRD updated with tab lists and routing notes; include a short “How to impersonate” section in README.

### QA & Release
- Maintain a regression checklist for header widget visibility, Admin exclusion, and Directory navigation.
- Ensure CI runs typecheck and lint on PRs; include a production build step.

### Forms & Scoping (carry-over)
- Build request forms for Service, Job, Supplies, and Products (prefill `q={code}`; simple submit success path).
- Confirm backend scoping for `/admin/{jobs,services,reports}` and `/news` (fixtures/tests).
- Add scope badges/banners on `/me` pages (active code and role).
