   1 # CKS ORDER WORKFLOW DOCUMENTATION
   2 
   3 ## Overview
   4 This document provides comprehensive documentation of all order workflows in the CKS Portal system, including service and product order lifecycles, approval stages, and role-based interactions.
   5 
   6 ## Order ID Format
   7 All orders follow a consistent ID format: `{UserID}-ORD-{TypeID}`
   8 - **UserID**: The ID of the user/entity creating the order (e.g., CRW001, CTR002, CUS003)
   9 - **ORD**: Fixed identifier indicating this is an order
  10 - **TypeID**: Either SRV### for service orders or PRD### for product orders
  11 
  12 Examples:
  13 - `CRW001-ORD-PRD001` - Product order created by Crew member CRW001
  14 - `CTR002-ORD-SRV005` - Service order created by Center CTR002
  15 
  16 ## Order Types
  17 
  18 ### 1. Service Orders
  19 Service orders are requests for CKS services (cleaning, maintenance, etc.)
  20 
  21 **Who can create:**
  22 - Customers
  23 - Centers
  24 - Contractors
  25 
  26 **Approval Flow:**
  27 1. Customer/Center/Contractor creates service request
  28 2. Manager reviews and creates service (transforms to service ID)
  29 3. Service is scheduled and assigned to crew
  30 4. Service execution and completion
  31 
  32 ### 2. Product Orders
  33 Product orders are requests for supplies and equipment from the warehouse.
  34 
  35 **Who can create:**
  36 - Crew members
  37 - Centers
  38 - Contractors
  39 - Customers
  40 - Managers
  41 
  42 **Approval Flow:**
  43 1. Requester creates product order
  44 2. Warehouse reviews (Accept/Deny)
  45 3. If accepted, warehouse prepares for delivery
  46 4. Delivery completion
  47 
  48 ## Order Status States
  49 
  50 ### Primary Status Values
  51 - **pending**: Action required by current user
  52 - **in-progress**: Waiting for other users to take action
  53 - **approved**: Order has been approved but not yet fulfilled
  54 - **rejected**: Order was denied
  55 - **delivered**: Product order has been delivered (final state)
  56 - **service-created**: Service order has been transformed into a service (final state)
  57 - **cancelled**: Order was cancelled by requester
  58 
  59 ### Visual Indicators
  60 - **Yellow (Pulsing)**: Active states requiring attention (pending, waiting, accepted but not delivered)
  61 - **Green**: Completed/approved states
  62 - **Red**: Rejected/cancelled states
  63 - **Blue**: In-progress states
  64 
  65 ## Approval Workflow Visualization
  66 
  67 Each order displays an approval workflow tree showing:
  68 ```
  69 Role → Role → Role
  70 ```
  71 
  72 Each stage shows:
  73 - **Role name**: The responsible party
  74 - **Status**: Current status (pending/approved/rejected/accepted)
  75 - **User ID**: Only shown for completed stages (not for pulsing/active stages)
  76 - **Timestamp**: When the action was taken (for completed stages)
  77 
  78 ### Visual States in Workflow
  79 1. **Completed Stage**: Green box with user ID and timestamp
  80 2. **Active Stage (Pending)**: Yellow pulsing box showing "pending"
  81 3. **Active Stage (Accepted)**: Yellow pulsing box showing "accepted"
  82 4. **Rejected Stage**: Red box with user ID and timestamp
  83 
  84 ## Product Order Workflow Examples
  85 
  86 ### Example 1: Pending Warehouse Acceptance
  87 **Order ID**: `CRW001-ORD-PRD001`
  88 **Created by**: CRW-001
  89 **Destination**: CTR-001
  90 **Status**: in-progress (for Crew), pending (for Warehouse)
  91 
  92 **Workflow Tree**:
  93 ```
  94 Crew (✓ Approved) → Warehouse (⏳ Pending)
  95 ```
  96 
  97 **Available Actions**:
  98 - Warehouse: Accept, Deny
  99 - Crew: View Details
 100 - Manager: View Details
 101 
 102 ### Example 2: Accepted by Warehouse (Pending Delivery)
 103 **Order ID**: `CRW001-ORD-PRD002`
 104 **Created by**: CRW-001
 105 **Destination**: CTR-002
 106 **Status**: in-progress (for Crew), approved (for Warehouse)
 107 
 108 **Workflow Tree**:
 109 ```
 110 Crew (✓ Approved) → Warehouse (⏳ Accepted)
 111 ```
 112 
 113 **Available Actions**:
 114 - Warehouse: View Details
 115 - Crew: View Details
 116 - Manager: View Details
 117 
 118 *Note: Warehouse "Accepted" still shows as pulsing yellow to indicate delivery is pending*
 119 
 120 **Delivery Completion Process**:
 121 - Accepted orders appear in Warehouse Deliveries tab
 122 - Warehouse clicks "Delivered" or "Cancel" button
 123 - Order immediately moves to Archive for all users with appropriate status
 124 
 125 ### Example 3: Delivered (Archived)
 126 **Order ID**: `CRW001-ORD-PRD003`
 127 **Created by**: CRW-001
 128 **Destination**: CTR-003
 129 **Status**: delivered (all users)
 130 
 131 **Workflow Tree**:
 132 ```
 133 Crew (✓ Approved) → Warehouse (✓ Approved)
 134 ```
 135 
 136 **Order Badge**: DELIVERED (green)
 137 **Available Actions**: View Details (shows delivery details, POD, waybill)
 138 
 139 ### Example 4: Rejected by Warehouse
 140 **Order ID**: `CRW001-ORD-PRD004`
 141 **Created by**: CRW-001
 142 **Destination**: CTR-001
 143 **Status**: rejected (all users)
 144 
 145 **Workflow Tree**:
 146 ```
 147 Crew (✓ Approved) → Warehouse (✗ Rejected)
 148 ```
 149 
 150 **Order Badge**: REJECTED (red)
 151 **Available Actions**: View Details (shows rejection reason)
 152 **Rejection Reason**: "Out of stock - requires special order"
 153 
 154 ### Example 5: Cancelled by Warehouse (During Delivery)
 155 **Order ID**: `CRW001-ORD-PRD005`
 156 **Created by**: CRW-001
 157 **Destination**: CTR-004
 158 **Status**: cancelled (all users)
 159 
 160 **Workflow Tree**:
 161 ```
 162 Crew (✓ Approved) → Warehouse (✗ Cancelled)
 163 ```
 164 
 165 **Order Badge**: CANCELLED (red)
 166 **Available Actions**: View Details (shows cancellation reason)
 167 **Cancellation Reason**: "Unable to fulfill due to shipping issues"
 168 
 169 ## Service Order Workflow Examples
 170 
 171 ### Example 1: Pending Manager Approval
 172 **Order ID**: `CTR001-ORD-SRV001`
 173 **Created by**: CTR-001
 174 **Status**: in-progress (for Center), pending (for Manager)
 175 
 176 **Workflow Tree**:
 177 ```
 178 Center (✓ Approved) → Manager (⏳ Pending)
 179 ```
 180 
 181 **Available Actions**:
 182 - Manager: Create Service
 183 - Center: Cancel
 184 
 185 ### Example 2: Service Created (Transformed)
 186 **Order ID**: `CTR001-ORD-SRV002`
 187 **Transformed to**: `SRV-2025-001`
 188 **Status**: service-created
 189 
 190 **Workflow Tree**:
 191 ```
 192 Center (✓ Approved) → Manager (✓ Service Created)
 193 ```
 194 
 195 **Order Badge**: SERVICE CREATED (green)
 196 **Shows**: "✓ Transformed to Service ID: SRV-2025-001"
 197 
 198 ## Role-Based Views
 199 
 200 ### Manager View
 201 - Can see ALL orders in the ecosystem
 202 - Service orders: Can "Create Service" when pending
 203 - Product orders: View only (monitoring)
 204 - Shows full workflow tree for all orders
 205 
 206 ### Warehouse View
 207 - Sees product orders requiring warehouse action
 208 - Pending orders show Accept/Deny buttons
 209 - Accepted orders appear in Deliveries tab for completion
 210 - **Deliveries Tab**: Three sub-tabs (One-Time, Recurring, Archive)
 211   - **Delivered Button**: Marks order as delivered (moves to archive, status: "delivered")
 212   - **Cancel Button**: Cancels order (moves to archive, status: "cancelled")
 213 - Cannot see service orders unless warehouse created them
 214 
 215 ### Crew View
 216 - Can create product orders
 217 - Sees their own product orders
 218 - Service orders they're assigned to
 219 - Limited workflow visibility
 220 
 221 ### Center/Customer/Contractor Views
 222 - Can create both service and product orders
 223 - See orders they created or are involved in
 224 - Can cancel pending orders they created
 225 
 226 ## Order Tabs Organization
 227 
 228 All order sections have three tabs:
 229 1. **Service Orders**: Active service order requests
 230 2. **Product Orders**: Active product order requests
 231 3. **Archive**: Completed/rejected orders (delivered, service-created, rejected)
 232 
 233 Each tab shows:
 234 - Count badge with number of orders
 235 - Search functionality
 236 - Action buttons (role-dependent)
 237 
 238 ## Action Buttons by Role
 239 
 240 ### Request Service Button
 241 Available for: Contractor, Customer, Center, Warehouse
 242 
 243 ### Request Products Button
 244 Available for: Contractor, Customer, Center, Crew, Manager
 245 
 246 ### View Details Action
 247 Available for all orders, shows different content based on status:
 248 - **Delivered**: "Delivery and order details will show here later. We will be able to add a POD or waybill here."
 249 - **Rejected**: "Rejection details will show here later. It will also show a waybill and a rejection reason."
 250 - **Pending/In-Progress**: "List of products ordered will show here and some other info."
 251 
 252 ## Order Card Display
 253 
 254 ### Collapsed State (Default)
 255 Shows single-line colored header with:
 256 - Expand arrow
 257 - Order type badge (SERVICE/PRODUCT)
 258 - Order ID (blue, clickable)
 259 - Title (gray)
 260 - Status badge (right-aligned)
 261 
 262 ### Expanded State
 263 Shows full details including:
 264 - Order Details section (Requested By, Destination, dates)
 265 - Approval Workflow visualization
 266 - Product/service items list
 267 - Action buttons
 268 - Transformation notice (for service-created orders)
 269 
 270 ## Status Logic Rules
 271 
 272 ### For Product Orders:
 273 1. **Crew creates order**:
 274    - Crew sees: status = 'in-progress'
 275    - Warehouse sees: status = 'pending'
 276 
 277 2. **Warehouse accepts**:
 278    - Crew sees: status = 'in-progress'
 279    - Warehouse sees: status = 'approved'
 280    - Workflow shows: Warehouse (accepted) - still pulsing
 281 
 282 3. **Warehouse delivers**:
 283    - All users see: status = 'delivered'
 284    - Order moves to Archive tab
 285 
 286 ### For Service Orders:
 287 1. **Customer/Center creates**:
 288    - Creator sees: status = 'in-progress'
 289    - Manager sees: status = 'pending'
 290 
 291 2. **Manager creates service**:
 292    - All users see: status = 'service-created'
 293    - Shows transformation to Service ID
 294    - Order moves to Archive tab
 295 
 296 ## Visual Design Elements
 297 
 298 ### Pulsing Animation
 299 Applied to active workflow stages using CSS animation:
 300 ```css
 301 @keyframes pulse {
 302   0%, 100% {
 303     opacity: 1;
 304     box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
 305   }
 306   50% {
 307     opacity: 0.9;
 308     box-shadow: 0 0 0 8px rgba(251, 191, 36, 0);
 309   }
 310 }
 311 ```
 312 
 313 Pulsing indicates stages requiring attention or awaiting action.
 314 
 315 ### Color Scheme
 316 - **Blue (#3b82f6)**: Order IDs, clickable elements
 317 - **Yellow (#fbbf24)**: Pending/active states
 318 - **Green (#10b981)**: Approved/completed states
 319 - **Red (#ef4444)**: Rejected/cancelled states
 320 - **Gray (#6b7280)**: Inactive/informational elements
 321 
 322 ## Data Fields
 323 
 324 ### Required Fields
 325 - `orderId`: Unique identifier
 326 - `orderType`: 'service' | 'product'
 327 - `title`: Order title/description
 328 - `requestedBy`: User ID who created order
 329 - `requestedDate`: Creation date
 330 - `status`: Current order status
 331 
 332 ### Optional Fields
 333 - `destination`: Delivery destination (for product orders)
 334 - `expectedDate`: Requested delivery/service date
 335 - `deliveryDate`: Actual delivery completion
 336 - `serviceStartDate`: When service begins
 337 - `approvalStages`: Workflow visualization array
 338 - `transformedId`: New ID after transformation
 339 - `items`: Array of products/services requested
 340 - `notes`: Additional order notes
 341 - `rejectionReason`: Why order was rejected
 342 
 343 ## Future Enhancements
 344 
 345 1. **Clickable IDs**: All user/center/warehouse IDs will be clickable to view details
 346 2. **POD Integration**: Proof of delivery upload and viewing
 347 3. **Waybill Tracking**: Integration with shipping providers
 348 4. **Email Notifications**: Automated alerts for status changes
 349 5. **Bulk Orders**: Multiple items in single order
 350 6. **Recurring Orders**: Automated repeat orders
 351 7. **Order Templates**: Save frequently used orders
 352 8. **Analytics Dashboard**: Order metrics and trends
 353 9. **Mobile App Integration**: Order management on mobile devices
 354 10. **API Integration**: Third-party system connectivity
 355 
 356 ## Testing Scenarios
 357 
 358 ### Product Order Flow Test
 359 1. Create order as Crew
 360 2. View in Warehouse (should show Accept/Deny)
 361 3. Accept order
 362 4. Verify buttons change to View Details only
 363 5. Verify workflow shows "accepted" while pulsing
 364 6. Simulate delivery
 365 7. Verify order moves to Archive
 366 
 367 ### Service Order Flow Test
 368 1. Create order as Center
 369 2. View in Manager hub
 370 3. Create Service action
 371 4. Verify transformation ID appears
 372 5. Verify order moves to Archive
 373 6. Check all roles can see final state
 374 
 375 ### Edge Cases to Test
 376 - Rejecting order with long reason text
 377 - Multiple orders from same user
 378 - Orders with many items
 379 - Simultaneous status updates
 380 - Search functionality across tabs
 381 - Tab count accuracy
 382 - Permission boundaries by role
 383 
 384 ## Notes for Developers
 385 
 386 1. **Status vs Workflow Display**: The `status` field controls actions and overall badge, while `approvalStages` controls the workflow tree visualization
 387 
 388 2. **Pulsing Logic**: Any stage with status 'pending', 'waiting', or 'accepted' (for warehouse) will pulse
 389 
 390 3. **Tab Organization**: Archive tab combines all final states (delivered, service-created, rejected)
 391 
 392 4. **Action Button Logic**: Determined by combination of user role, order type, and current status
 393 
 394 5. **Date Fields**: Multiple date fields track different milestones (requested, expected, actual delivery, etc.)
 395 
 396 ---
 397 
 398 *Last Updated: 2025-09-19*
 399 *Version: 1.0*
